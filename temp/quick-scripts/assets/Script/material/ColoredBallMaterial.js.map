{"version":3,"sources":["ColoredBallMaterial.js"],"names":["math","cc","vmath","renderEngine","renderer","gfx","Material","DEG","Math","PI","require","ColoredBallMaterial","color","maker","rotationMatrix","ratio","call","_texture","_highlight","_color","vec4","new","_marker","_rotationMatrix","_ratio","pass","Pass","setDepth","setCullMode","CULL_NONE","setBlend","BLEND_FUNC_ADD","BLEND_SRC_ALPHA","BLEND_ONE_MINUS_SRC_ALPHA","mainTech","Technique","name","type","PARAM_TEXTURE_2D","PARAM_MAT4","PARAM_FLOAT4","PARAM_INT","PARAM_FLOAT","_effect","effect","Effect","iTexture","highlight","marker","_mainTech","js","extend","mixin","prototype","getTexture","setTexture","val","update","setProperty","getImpl","setHighlight","setRotationMatrix","setColor","setMarker","setRatio","module","exports"],"mappings":"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","file":"ColoredBallMaterial.js","sourceRoot":"../../../../../assets/Script/material","sourcesContent":["const math = cc.vmath;\nconst renderEngine = cc.renderer.renderEngine;\nconst renderer = renderEngine.renderer;\nconst gfx = renderEngine.gfx;\nconst Material = renderEngine.Material;\n\nconst DEG = Math.PI / 180;\n\n// Require to load the shader to program lib\nrequire('./ColoredBallShader');\n\nfunction ColoredBallMaterial(color, maker, rotationMatrix, ratio) {\n  Material.call(this, false);\n\n  this._texture = null;\n  this._highlight = null;\n  this._color = math.vec4.new(.1, .9, .1, 1);\n  this._marker = 0;\n  this._rotationMatrix = rotationMatrix;\n  this._ratio = ratio;\n\n  var pass = new renderer.Pass('ColoredBall');\n  pass.setDepth(false, false);\n  pass.setCullMode(gfx.CULL_NONE);\n  pass.setBlend(\n    gfx.BLEND_FUNC_ADD,\n    gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA,\n    gfx.BLEND_FUNC_ADD,\n    gfx.BLEND_SRC_ALPHA, gfx.BLEND_ONE_MINUS_SRC_ALPHA\n  );\n\n  let mainTech = new renderer.Technique(\n    ['transparent'],\n    [\n      { name: 'iTexture', type: renderer.PARAM_TEXTURE_2D },\n      { name: 'highlight', type: renderer.PARAM_TEXTURE_2D },\n      { name: 'rotationMatrix', type: renderer.PARAM_MAT4 },\n      { name: 'color', type: renderer.PARAM_FLOAT4 },\n      { name: 'marker', type: renderer.PARAM_INT },\n      { name: 'ratio', type: renderer.PARAM_FLOAT },\n    ],\n    [ pass ]\n  );\n\n  // need _effect to calculate hash\n  this._effect = this.effect = new renderer.Effect(\n    [ mainTech ],\n    {\n      iTexture: this._texture,\n      highlight: this._highlight,\n      rotationMatrix: this._rotationMatrix,\n      color: this._color,\n      marker: this._marker,\n      ratio: this._ratio,\n    },\n    []\n  );\n\n  this._mainTech = mainTech;\n}\ncc.js.extend(ColoredBallMaterial, Material);\ncc.js.mixin(ColoredBallMaterial.prototype, {\n  getTexture () {\n    return this._texture;\n  },\n\n  setTexture (val) {\n    if (this._texture !== val) {\n      this._texture = val;\n      this._texture.update();\n      this.effect.setProperty('iTexture', val.getImpl());\n    }\n  },\n\n  setHighlight(val) {\n    if (this._highlight !== val) {\n      this._highlight = val;\n      this._highlight.update();\n      this.effect.setProperty('highlight', val.getImpl());\n    }\n  },\n\n  setRotationMatrix(val) {\n    this._rotationMatrix = val;\n    this.effect.setProperty('rotationMatrix', val);\n  },\n\n  setColor(val) {\n    this._color = val;\n    this.effect.setProperty('color', val);\n  },\n\n  setMarker(val) {\n    this._marker = !!val ? 1 : 0;\n    this.effect.setProperty('marker', val);\n  },\n\n  setRatio(val) {\n    this._ratio = val;\n    this.effect.setProperty('ratio', val);\n  },\n});\n\nmodule.exports = ColoredBallMaterial;\n"]}